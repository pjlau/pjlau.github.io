<html>
<body onload='init()'>
<!DOCTYPE html>
<meta charset="utf-8">
<style> rect {fill: lightblue; stroke: black; }</style>
<!-- Load d3.js -->
<script src='https://d3js.org/d3.v5.min.js'></script>
<!-- Create a div where the graph will take place -->
<div id="my_dataviz"></div>

</svg>
<script>
  //var data = [4,8,15,16,23,42];
	// Define margins and chart dimensions
  d3.csv("data/adult_bin.csv").then(function(data) {
	  
  const margin = { top: 50, right: 50, bottom: 50, left: 50 };
  const width = 300 - margin.left - margin.right;
  const height = 300 - margin.top - margin.bottom;
  var age = data.age;
  // Convert age from string to int
  var age_int = age.map(function(d) { return +d; }); 
	  
  const dmax = d3.max(age_int);

  // Create SVG element
  //const svg = d3.select("#my_dataviz").append("svg");
  // append the svg object to the body of the page
  const svg = d3.select("#my_dataviz")
	  .append("svg")
	    .attr("width", width + margin.left + margin.right)
	    .attr("height", height + margin.top + margin.bottom);
  
  const g = svg.append("g")
.attr("transform", "translate(" + margin.left + "," + margin.top + ")");  

  var xdom = Array(90).fill(0).map((e,i)=>e+(i*1));
  // Define x-axis scale
  const xScale = d3.scaleBand()
    .domain(xdom)
    .range([0, width]);
  const yScale = d3.scaleLinear()
    .domain([0, dmax])
    .range([height,0]);

  const xAxis = d3.axisBottom(xScale);
  const yAxis = d3.axisLeft(yScale);

  // Create bars based on data
  g.selectAll("rect")
    .data(age_int)
    .enter()
    .append("rect")
    .attr("x", (d, i) => xScale(i))  
    .attr("y", d => height - d*height/dmax)  // Position bars from top (y-axis)
    .attr("width", xScale.bandwidth())  // Set width using scale's bandwidth
    .attr("height", d => d*height/dmax);  // Set height based on data value

   svg.append("g")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
      .call(yAxis); 
    const xheight = height + margin.top;
    
   svg.append("g")
     .attr("transform", "translate(" + margin.left + "," + xheight + ")")
      .call(xAxis);
  }
</script>
</body>
</html>
